<?xml version="1.0" encoding="utf-8"?>

<Patch>
  <!-- EVA description -->
  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase" or @ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"][not(comps)]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase" or @ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"][not(comps)]</xpath>
      <value>
        <comps />
      </value>
    </match>
  </Operation>

  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase" or @ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"]/comps[not(li/compClass="SaveOurShip2.Comp_EVA")]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase" or @ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"]/comps[not(li/compClass="SaveOurShip2.Comp_EVA")]</xpath>
      <value>
        <li>
          <compClass>SaveOurShip2.Comp_EVA</compClass>
        </li>
      </value>
    </match>
  </Operation>

  <!-- EVA stats -->
  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase" or @ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"][not(equippedStatOffsets)]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase" or @ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"][not(equippedStatOffsets)]</xpath>
      <value>
        <equippedStatOffsets />
      </value>
    </match>
  </Operation>

  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase"][techLevel="Spacer"]/equippedStatOffsets[not(DecompressionResistance)]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[@ParentName="ArmorMachineableBase"][techLevel="Spacer"]/equippedStatOffsets[not(DecompressionResistance)]</xpath>
      <value>
        <DecompressionResistance>0.75</DecompressionResistance>
      </value>
    </match>
  </Operation>

  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[@ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"]/equippedStatOffsets[not(DecompressionResistance)]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[@ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"]/equippedStatOffsets[not(DecompressionResistance)]</xpath>
      <value>
        <DecompressionResistance>0.25</DecompressionResistance>
      </value>
    </match>
  </Operation>

  <Operation Class="PatchOperationConditional">
    <xpath>Defs/ThingDef[@ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"]/equippedStatOffsets[not(HypoxiaResistance)]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>Defs/ThingDef[@ParentName="ArmorHelmetMakeableBase"][techLevel="Spacer"]/equippedStatOffsets[not(HypoxiaResistance)]</xpath>
      <value>
        <HypoxiaResistance>1</HypoxiaResistance>
      </value>
    </match>
  </Operation>

  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[@Name="ApparelArmorReconBase"]/statBases/Insulation_Cold</xpath>
    <value>
      <Insulation_Cold>80</Insulation_Cold>
    </value>
  </Operation>

  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[@Name="ApparelArmorPowerBase"]/statBases/Insulation_Cold</xpath>
    <value>
      <Insulation_Cold>90</Insulation_Cold>
    </value>
  </Operation>

  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Royalty</li>
    </mods>

    <match Class="PatchOperationReplace">
      <xpath>Defs/ThingDef[@Name="ApparelArmorCataphractBase"]/statBases/Insulation_Cold</xpath>
      <value>
        <Insulation_Cold>100</Insulation_Cold>
      </value>
    </match>
  </Operation>
</Patch>
